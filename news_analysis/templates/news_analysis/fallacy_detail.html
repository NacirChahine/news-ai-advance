{% extends "base.html" %}

{% block title %}{{ fallacy.name }}  Logical Fallacy{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row">
    <div class="col-12 col-lg-10 mx-auto">
      <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{% url 'news_analysis:fallacies' %}">Logical Fallacies</a></li>
          <li class="breadcrumb-item active" aria-current="page">{{ fallacy.name }}</li>
        </ol>
      </nav>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h1 class="h3 mb-0">{{ fallacy.name }}</h1>
        <span class="badge bg-secondary" title="Total detections">{{ detections.paginator.count }}</span>
      </div>
      <p class="text-muted">{{ fallacy.description }}</p>
      {% if fallacy.example %}
      <div class="alert alert-light border small"><strong>Example:</strong> {{ fallacy.example }}</div>
      {% endif %}

      <hr/>
      <h2 class="h5 mb-3">Articles with this detection</h2>
      {% if detections %}
        <div class="list-group mb-3">
          {% for det in detections %}
          <div class="list-group-item">
            <div class="d-flex w-100 justify-content-between">
              <h5 class="mb-1"><a class="text-decoration-none" href="{% url 'news_aggregator:article_detail' article_id=det.article.id %}#fallacy-detection-{{ det.id }}">{{ det.article.title }}</a></h5>
              <small class="text-muted">{{ det.detected_at|date:"M d, Y H:i" }}</small>
            </div>
            <div class="small text-muted mb-1">Source: {{ det.article.source.name }}</div>
            {% if det.evidence_excerpt %}
            <div class="mt-1">
              <div class="small text-muted">Evidence excerpt:</div>
              <blockquote class="blockquote small mb-2" style="border-left:3px solid #ddd;padding-left:.75rem;">
                “{{ det.evidence_excerpt }}”
              </blockquote>
            </div>
            {% endif %}
            <div>
              <a class="btn btn-sm btn-outline-primary" href="{% url 'news_aggregator:article_detail' article_id=det.article.id %}#fallacy-detection-{{ det.id }}">
                <i class="fas fa-highlighter me-1"></i> View in article
              </a>
              <a class="btn btn-sm btn-outline-secondary" href="{% url 'news_aggregator:article_detail' article_id=det.article.id %}">
                <i class="fas fa-file-alt me-1"></i> Article page
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
        {% if detections.has_other_pages %}
        <nav aria-label="Fallacy detections pagination">
          <ul class="pagination">
            {% if detections.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ detections.previous_page_number }}">Previous</a></li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">Previous</span></li>
            {% endif %}
            <li class="page-item disabled"><span class="page-link">Page {{ detections.number }} of {{ detections.paginator.num_pages }}</span></li>
            {% if detections.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ detections.next_page_number }}">Next</a></li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">Next</span></li>
            {% endif %}
          </ul>
        </nav>
        {% endif %}
      {% else %}
        <div class="alert alert-info">No detections yet for this fallacy.</div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

